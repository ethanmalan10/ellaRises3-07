<%
  // Normalize possible names for the donation flash coming from server
  const _donated = (typeof donated !== 'undefined' ? donated : (typeof thanks !== 'undefined' ? thanks : undefined));
  const _donor   = (typeof donor   !== 'undefined' ? donor   : (typeof donorName   !== 'undefined' ? donorName   : ''));
  const _amount  = (typeof amount  !== 'undefined' ? amount  : (typeof donorAmount !== 'undefined' ? donorAmount : ''));
%>

<% if (typeof _donated !== 'undefined' && _donated) { %>
  <div id="donation-toast"
       style="
         position:fixed; left:50%; bottom:24px; transform:translateX(-50%);
         background:#2e2f2e; color:white; padding:14px 18px; border-radius:12px;
         box-shadow:0 8px 24px rgba(0,0,0,.25); z-index:9999; font-weight:600;">
    <%= (_donor && _donor.trim().length) ? _donor : 'Thank you' %>
    donated <%= (_amount && _amount.trim().length) ? `$${_amount}` : '' %> ðŸŽ‰
  </div>
  <script>
    // Auto-hide after 4s and clean query params so it won't reappear on refresh
    setTimeout(() => {
      const t = document.getElementById('donation-toast');
      if (t) t.remove();
      try {
        const url = new URL(window.location.href);
        ['thanks','donated','name','donor','amount','donorName','donorAmount'].forEach(k => url.searchParams.delete(k));
        window.history.replaceState({}, '', url);
      } catch {}
    }, 4000);
  </script>
<% } %>

<%
  // Safely read logged-in user from locals
  const user = locals.currentUser || null;
  const milestoneHighlights = (locals && locals.milestoneHighlights) || [];
%>

<!-- HERO SLIDER -->
<section class="hero-slider-wrap" style="margin-top:0;">
  <div class="hero-slider" id="hero-slider" role="region" aria-roledescription="carousel" aria-label="Ella Rises highlights" aria-live="off">
    <div class="hero-slide active" data-title="Join us today" aria-hidden="false">
      <a href="/events">
        <img src="/images/coloring.jpg" alt="Coloring activity" />
        <div class="overlay-text overlay-top-right">Join us Today!</div>
        <img
          src="/images/EllaRisesLogo.avif"
          alt="Ella Rises logo"
          style="
            position:absolute;
            top:100px;
            right: 0px;
            width:500px;
            height:auto;
            display:block;
            filter:
              grayscale(1)
              sepia(0.65)
              brightness(1.05)
              saturate(1.1)
              hue-rotate(330deg)
              drop-shadow(0 8px 18px rgba(249,175,177,0.45));
          "
        >
      </a>
    </div>

    <div class="hero-slide" data-title="Donate" aria-hidden="true">
      <a href="/donations">
        <img src="/images/ER BYU Tour 2022-042.jpg" alt="BYU tour" />
        <div class="overlay-text overlay-top-left" style="font-size:2.4rem;">Donate!</div>
      </a>
    </div>

    <div class="hero-slide" data-title="Summer summit" aria-hidden="true">
      <a href="/events">
        <img src="/images/ER Summer Summit 2022-068.jpg" alt="Summer summit" />
      </a>
    </div>

    <div class="hero-slide" data-title="Learn and connect" aria-hidden="true">
      <a href="/register">
        <img src="/images/ER STEM Workshop Aug 2022-09.jpg" alt="STEM workshop" />
        <div class="overlay-text overlay-top">Learn and Connect</div>
      </a>
    </div>

    <div class="hero-controls" style="display:flex; gap:10px; align-items:center; padding:8px 0;">
      <button class="slider-nav prev" id="hero-prev" type="button" aria-label="Previous slide">&#10094;</button>
      <button class="slider-nav next" id="hero-next" type="button" aria-label="Next slide">&#10095;</button>
      <button class="btn-cream" id="hero-toggle" type="button" aria-pressed="false" style="padding:8px 12px; border-radius:10px;">Pause slides</button>
      <span class="sr-only" id="hero-status" aria-live="polite" aria-atomic="true"></span>
    </div>
  </div>
</section>

  <!-- MISSION STATEMENT -->
  <section class="container" style="margin:1rem auto 0.5rem auto;">
    <div class="card" style="padding:28px; border-radius:18px;">
      <h2 style="text-align:center; margin:0 0 10px 0; font-family: var(--font-serif);">
        Our Mission
      </h2>
      <p style="max-width:900px; margin:0 auto; text-align:center;">
        Empowering young women through mentoring, creative workshops, and leadership opportunities.
        We believe in confidence, community, and growth together.
      </p>
      <div style="margin-top:16px; border-radius:16px; overflow:hidden; box-shadow: 0 6px 18px rgba(0,0,0,0.08);">
        <img
          src="/images/ER Summer Summit 2022-165.jpg"
          alt="Ella Rises collage"
          style="width:100%; height:320px; object-fit:cover; display:block;"
        />
      </div>
    </div>
  </section>

  <hr style="width:90%; margin:24px auto; border:0; border-top:2px solid var(--charcoal); opacity:0.2;">

  <!-- CTA SECTION -->
  <section class="container" style="margin:1.25rem auto 2.25rem;">
    <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(280px,1fr)); gap:22px;">

      <!-- ENROLL CARD -->
      <div class="card" style="padding:28px; border-radius:18px;">
        <h3 style="margin:0 0 10px 0; font-family: var(--font-serif);">Enroll</h3>
        <p style="margin:0 0 16px 0;">
          Join Ella Rises as a participant. Build confidence, skills, and leadership.
        </p>
        <div style="margin:0 0 12px 0; border-radius:12px; overflow:hidden; box-shadow:0 4px 12px rgba(0,0,0,0.08);">
          <img src="/images/ER STEM Workshop.jpg" alt="STEM workshop" style="width:100%; height:220px; object-fit:cover; display:block;">
        </div>

        <a
          href="<%= user ? '/my-account' : '/register' %>"
          class="btn-login-home"
          style="
            width:100%;
            display:block;
            text-align:center;
            padding:14px 0;
            font-size:1.1rem;
            border-radius: 10px;
          "
        >
          <%= user ? 'Go to My Account' : 'Create Account' %>
        </a>
      </div>

      <!-- DONATIONS CARD -->
      <div class="card" style="padding:28px; border-radius:18px;">
        <h3 style="margin:0 0 10px 0; font-family: var(--font-serif);">Donations</h3>
        <p style="margin:0 0 16px 0;">
          Your generosity fuels mentorships, workshops, and opportunities for our community.
        </p>
        <div style="margin:0 0 12px 0; border-radius:12px; overflow:hidden; box-shadow:0 4px 12px rgba(0,0,0,0.08);">
          <img src="/images/ER UMFA Mural_072.jpg" alt="UMFA mural" style="width:100%; height:220px; object-fit:cover; display:block;">
        </div>

        <a
          href="/donations"
          class="btn-login-home"
          style="
            width:100%;
            display:block;
            text-align:center;
            padding:14px 0;
            font-size:1.1rem;
            border-radius: 10px;
          "
        >
          Give Today
        </a>
      </div>

    </div>
  </section>


<script>
  (function(){
    const slider = document.getElementById('hero-slider');
    if (!slider) return;
    const slides = Array.from(slider.querySelectorAll('.hero-slide'));
    const prevBtn = document.getElementById('hero-prev');
    const nextBtn = document.getElementById('hero-next');
    const toggleBtn = document.getElementById('hero-toggle');
    const status = document.getElementById('hero-status');
    if (!slides.length) return;

    const reduceMotion = window.matchMedia('(prefers-reduced-motion: reduce)');
    let current = 0;
    let timer = null;
    let playing = !reduceMotion.matches;

    const updateSlides = () => {
      slides.forEach((slide, idx) => {
        const isActive = idx === current;
        slide.classList.toggle('active', isActive);
        slide.setAttribute('aria-hidden', isActive ? 'false' : 'true');
      });
      if (status) {
        const title = slides[current].dataset.title || `Slide ${current + 1}`;
        status.textContent = `Slide ${current + 1} of ${slides.length}: ${title}`;
      }
    };

    const showSlide = (index) => {
      current = (index + slides.length) % slides.length;
      updateSlides();
    };

    const next = () => showSlide(current + 1);
    const prev = () => showSlide(current - 1);

    const stop = () => {
      if (timer) {
        clearInterval(timer);
        timer = null;
      }
      playing = false;
      if (toggleBtn) {
        toggleBtn.setAttribute('aria-pressed', 'false');
        toggleBtn.textContent = 'Play slides';
      }
    };

    const start = () => {
      if (reduceMotion.matches) return;
      if (timer) clearInterval(timer);
      timer = setInterval(next, 5000);
      playing = true;
      if (toggleBtn) {
        toggleBtn.setAttribute('aria-pressed', 'true');
        toggleBtn.textContent = 'Pause slides';
      }
    };

    prevBtn?.addEventListener('click', () => { stop(); prev(); });
    nextBtn?.addEventListener('click', () => { stop(); next(); });
    toggleBtn?.addEventListener('click', () => { playing ? stop() : start(); });

    reduceMotion.addEventListener?.('change', (e) => {
      if (e.matches) {
        stop();
      } else if (playing) {
        start();
      }
    });

    updateSlides();
    if (playing) start();
  })();
</script>
