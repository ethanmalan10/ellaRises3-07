<main class="container main-content" style="max-width:760px; margin-top:2.5rem;">
  <% function val(v){ return typeof v === 'undefined' || v === null ? '' : v; } %>
  <div class="card" style="padding:32px; border-radius:14px;">
    <h2 style="margin:0 0 1rem 0; font-family:var(--font-serif); color:var(--charcoal);">Edit Event Template</h2>
    <p style="margin:0 0 1rem 0; color:#4b5563;">Update template details. Changes apply to future occurrences you create from this template.</p>

    <% if (error) { %>
      <div style="background:#ffe1e1; border:1px solid #dd9a9a; color:#7a2e2e; padding:12px 16px; border-radius:10px; margin-bottom:1rem;">
        <%= error %>
      </div>
    <% } %>

    <form id="template-form" method="POST" action="/event-templates/<%= template.eventtemplateid %>/edit" novalidate>
      <div style="margin-bottom:1rem;">
        <label style="font-weight:600; display:block; margin-bottom:.35rem;">Event Type</label>
        <select name="eventtypeid" required style="width:100%; padding:12px; border-radius:10px;">
          <% types.forEach(t => { %>
            <option value="<%= t.eventtypeid %>" <%= t.eventtypeid === template.eventtypeid ? 'selected' : '' %>><%= t.eventtypename %></option>
          <% }) %>
        </select>
      </div>

      <div style="margin-bottom:1rem;">
        <label style="font-weight:600; display:block; margin-bottom:.35rem;">Event Name</label>
        <input name="eventname" type="text" value="<%= val(template.eventname) %>" required style="width:100%; padding:12px; border-radius:10px;">
      </div>

      <div style="margin-bottom:1rem;">
        <label style="font-weight:600; display:block; margin-bottom:.35rem;">Description</label>
        <textarea name="eventdescription" rows="4" style="width:100%; padding:12px; border-radius:10px;"><%= val(template.eventdescription) %></textarea>
      </div>

      <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(220px, 1fr)); gap:12px; margin-bottom:1rem;">
      <div>
        <label style="font-weight:600; display:block; margin-bottom:.35rem;">Recurrence Pattern</label>
        <% const rec = (template.eventrecurrencepattern || '').toLowerCase(); %>
        <select name="eventrecurrencepattern" id="recurrenceSelect" style="width:90%; padding:12px; border-radius:10px;">
          <option value="">Select</option>
          <option value="Weekly" <%= rec === 'weekly' ? 'selected' : '' %>>Weekly</option>
          <option value="Monthly" <%= rec === 'monthly' ? 'selected' : '' %>>Monthly</option>
          <option value="Quarterly" <%= rec === 'quarterly' ? 'selected' : '' %>>Quarterly</option>
          <option value="Annually" <%= rec === 'annually' ? 'selected' : '' %>>Annually</option>
          <option value="Other" <%= rec && ['weekly','monthly','quarterly','annually'].indexOf(rec) === -1 ? 'selected' : '' %>>Other</option>
        </select>
        <input name="eventrecurrencepattern_other" id="recurrenceOther" type="text" value="<%= rec && ['weekly','monthly','quarterly','annually'].indexOf(rec) === -1 ? template.eventrecurrencepattern : '' %>" placeholder="Enter custom recurrence" style="width:90%; padding:12px; border-radius:10px; margin-top:8px; display:<%= rec && ['weekly','monthly','quarterly','annually'].indexOf(rec) === -1 ? 'block' : 'none' %>;">
      </div>
        <div>
          <label style="font-weight:600; display:block; margin-bottom:.35rem;">Default Capacity</label>
          <input name="eventdefaultcapacity" type="number" min="1" value="<%= val(template.eventdefaultcapacity) %>" placeholder="e.g., 100" style="width:90%; padding:12px; border-radius:10px;">
        </div>
      </div>

      <div style="display:flex; gap:12px; align-items:center; margin-top:1.2rem;">
        <button type="submit" class="btn-gradient" style="padding:12px 18px; border-radius:12px;">Save Changes</button>
        <a href="/event-templates" class="btn-cream" style="padding:10px 16px; border-radius:10px; text-decoration:none;">Cancel</a>
      </div>
    </form>
  </div>
</main>

<script>
  (function(){
    const recSel = document.getElementById('recurrenceSelect');
    const recOther = document.getElementById('recurrenceOther');
    if (recSel && recOther) {
      const sync = () => {
        const showOther = recSel.value === 'Other';
        recOther.style.display = showOther ? 'block' : 'none';
        if (showOther) {
          recOther.name = 'eventrecurrencepattern';
          recSel.name = 'eventrecurrencepattern_ignore';
        } else {
          recSel.name = 'eventrecurrencepattern';
          recOther.name = 'eventrecurrencepattern_other';
          recOther.value = '';
        }
      };
      recSel.addEventListener('change', sync);
      sync();
    }
  })();
</script>
