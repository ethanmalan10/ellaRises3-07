<main class="container main-content" style="max-width:760px; margin-top:3rem;">
  <div class="card" style="padding:40px; border-radius:16px;">

    <h2 style="text-align:center; margin:0 0 1.5rem 0; font-family:var(--font-serif);">
      Create Account
    </h2>

    <!-- Error message -->
    <% if (typeof error !== "undefined" && error) { %>
      <div style="
        background:#ffe1e1;
        border:1px solid #dd9a9a;
        color:#7a2e2e;
        padding:12px 16px;
        border-radius:10px;
        margin-bottom:1.25rem;">
        <%= error %>
      </div>
    <% } %>

    <form action="/register" method="POST" novalidate>

      <!-- FIRST NAME -->
      <div style="margin-bottom:1rem;">
        <label style="font-weight:600; display:block; margin-bottom:.35rem;">First Name <span style="color:#6b7280; font-size:.9em;">(required)</span></label>
        <input
          name="firstName"
          type="text"
          required
          value="<%= (formData && formData.firstName) || '' %>"
          style="width:100%; padding:12px; border-radius:10px;"
          onblur="this.value = formatCap(this.value)">
      </div>

      <!-- LAST NAME -->
      <div style="margin-bottom:1rem;">
        <label style="font-weight:600; display:block; margin-bottom:.35rem;">Last Name <span style="color:#6b7280; font-size:.9em;">(required)</span></label>
        <input
          name="lastName"
          type="text"
          required
          value="<%= (formData && formData.lastName) || '' %>"
          style="width:100%; padding:12px; border-radius:10px;"
          onblur="this.value = formatCap(this.value)">
      </div>

      <!-- EMAIL -->
      <div style="margin-bottom:1rem;">
        <label style="font-weight:600; display:block; margin-bottom:.35rem;">Email <span style="color:#6b7280; font-size:.9em;">(required)</span></label>
        <input
          name="email"
          type="email"
          required
          value="<%= (formData && formData.email) || '' %>"
          style="width:100%; padding:12px; border-radius:10px;">
      </div>

      <!-- PASSWORD -->
      <div style="margin-bottom:1rem;">
        <label style="font-weight:600; display:block; margin-bottom:.35rem;">Password <span style="color:#6b7280; font-size:.9em;">(required)</span></label>
        <input
          name="password"
          type="password"
          required
          style="width:100%; padding:12px; border-radius:10px;">
      </div>

      <!-- CONFIRM PASSWORD -->
      <div style="margin-bottom:1rem;">
        <label style="font-weight:600; display:block; margin-bottom:.35rem;">Confirm Password <span style="color:#6b7280; font-size:.9em;">(required)</span></label>
        <input
          name="confirmPassword"
          type="password"
          required
          style="width:100%; padding:12px; border-radius:10px;">
      </div>

      <!-- DATE OF BIRTH -->
      <div style="margin-bottom:1rem;">
        <label style="font-weight:600; display:block; margin-bottom:.35rem;">Date of Birth <span style="color:#6b7280; font-size:.9em;">(required)</span></label>
        <input
          name="dob"
          type="date"
          required
          value="<%= (formData && formData.dob) || '' %>"
          style="width:100%; padding:12px; border-radius:10px;">
      </div>

      <!-- AFFILIATION -->
      <div style="margin-bottom:1rem;">
        <label style="font-weight:600; display:block; margin-bottom:.35rem;">Affiliation Type <span style="color:#6b7280; font-size:.9em;">(required)</span></label>
        <div style="display:flex; gap:18px; align-items:center; flex-wrap:wrap;">
          <label style="display:flex; align-items:center; gap:6px;">
            <input type="radio" name="affiliationType" value="School" <%= formData && formData.affiliationType === 'School' ? 'checked' : '' %> onchange="toggleAffiliationName(true)">
            School
          </label>
          <label style="display:flex; align-items:center; gap:6px;">
            <input type="radio" name="affiliationType" value="Employer" <%= formData && formData.affiliationType === 'Employer' ? 'checked' : '' %> onchange="toggleAffiliationName(true)">
            Employer
          </label>
        </div>
      </div>

      <div id="affiliationNameGroup" style="margin-bottom:1rem; display:<%= formData && formData.affiliationType ? 'block' : 'none' %>;">
        <label style="font-weight:600; display:block; margin-bottom:.35rem;">
          Affiliation Name <span style="color:#6b7280; font-size:.9em;">(required)</span>
        </label>
        <input
          id="affiliationName"
          name="affiliationName"
          type="text"
          value="<%= (formData && formData.affiliationName) || '' %>"
          style="width:100%; padding:12px; border-radius:10px;"
          onblur="this.value = this.value.trim()"
        >
      </div>

      <!-- PHONE NUMBER -->
      <div style="margin-bottom:1rem;">
        <label style="font-weight:600; display:block; margin-bottom:.35rem;">Phone Number <span style="color:#6b7280; font-size:.9em;">(required)</span></label>
        <input
          name="phone"
          type="text"
          required
          inputmode="tel"
          value="<%= (formData && formData.phone) || '' %>"
          style="width:100%; padding:12px; border-radius:10px;"
          pattern="\\d*"
          onkeypress="return allowDigits(event)"
          oninput="digitsOnly(this)"
          onblur="digitsOnly(this)">
      </div>

      <!-- CITY / STATE / ZIP -->
      <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:12px; margin-bottom:1.2rem;">
        <div>
          <label style="font-weight:600; display:block; margin-bottom:.35rem;">City <span style="color:#6b7280; font-size:.9em;">(required)</span></label>
          <input name="city" type="text" required value="<%= (formData && formData.city) || '' %>" style="width:100%; padding:12px; border-radius:10px;" onblur="this.value = formatCap(this.value)">
        </div>
        <div>
          <label style="font-weight:600; display:block; margin-bottom:.35rem;">State <span style="color:#6b7280; font-size:.9em;">(required)</span></label>
          <select name="state" required style="width:100%; padding:12px; border-radius:10px;">
            <option value="">Select</option>
            <% const states = ['AL','AK','AZ','AR','CA','CO','CT','DE','FL','GA','HI','ID','IL','IN','IA','KS','KY','LA','ME','MD','MA','MI','MN','MS','MO','MT','NE','NV','NH','NJ','NM','NY','NC','ND','OH','OK','OR','PA','RI','SC','SD','TN','TX','UT','VT','VA','WA','WV','WI','WY','Other']; %>
            <% states.forEach(st => { %>
              <option value="<%= st %>" <%= (formData && formData.state === st) ? 'selected' : '' %>><%= st %></option>
            <% }) %>
          </select>
        </div>
        <div>
          <label style="font-weight:600; display:block; margin-bottom:.35rem;">Zipcode <span style="color:#6b7280; font-size:.9em;">(required)</span></label>
          <input name="zipcode" type="text" required inputmode="numeric" pattern="\\d*" value="<%= (formData && formData.zipcode) || '' %>" style="width:100%; padding:12px; border-radius:10px;" oninput="digitsOnly(this)">
        </div>
      </div>

      <!-- INTERESTS RADIO -->
      <div style="margin-bottom:1.25rem;">
        <label style="font-weight:600; display:block; margin-bottom:.45rem;">
          What are your interests in this program?
        </label>

        <div style="display:flex; gap:18px;">
          <label style="display:flex; align-items:center; gap:6px;">
            <input type="radio" name="interest" value="arts" <%= formData && formData.interest === 'arts' ? 'checked' : '' %>> Arts
          </label>
          <label style="display:flex; align-items:center; gap:6px;">
            <input type="radio" name="interest" value="stem" <%= formData && formData.interest === 'stem' ? 'checked' : '' %>> STEM
          </label>
          <label style="display:flex; align-items:center; gap:6px;">
            <input type="radio" name="interest" value="both" <%= formData && formData.interest === 'both' ? 'checked' : '' %>> Both
          </label>
        </div>
      </div>

      <!-- SUBMIT BUTTON -->
      <button
        type="submit"
        class="btn-gradient"
        style="width:100%; padding:14px; font-size:1.05rem; border-radius:12px;">
        Create Account
      </button>

      <!-- LINK TO LOGIN -->
      <div style="text-align:center; margin-top:1rem;">
        <a href="/login" style="text-decoration:none; font-weight:600; color:var(--charcoal); opacity:.8;">
          Already have an account? Login
        </a>
      </div>

    </form>

  </div>
</main>

<script>
  function formatCap(val) {
    if (!val) return '';
    const s = val.trim();
    if (!s) return '';
    return s[0].toUpperCase() + s.slice(1).toLowerCase();
  }
  function digitsOnly(el) {
    if (!el) return;
    el.value = (el.value || '').replace(/\\D/g, '');
  }
  function allowDigits(e) {
    const k = e.key;
    if (k === 'Backspace' || k === 'Delete' || k === 'Tab' || k === 'ArrowLeft' || k === 'ArrowRight') return true;
    if (/\d/.test(k)) return true;
    e.preventDefault();
    return false;
  }
  function toggleAffiliationName(show) {
    const grp = document.getElementById('affiliationNameGroup');
    const inp = document.getElementById('affiliationName');
    if (grp && inp) {
      grp.style.display = show ? 'block' : 'none';
      inp.required = !!show;
    }
  }
  // initialize based on existing selection
  document.addEventListener('DOMContentLoaded', () => {
    const checked = document.querySelector('input[name="affiliationType"]:checked');
    toggleAffiliationName(!!checked);
  });
</script>
