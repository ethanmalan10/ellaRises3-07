<main class="container main-content" style="max-width:880px; margin-top:2.5rem;">
  <header style="display:flex; justify-content:space-between; align-items:flex-start; gap:1.25rem; flex-wrap:wrap; margin-bottom:1.5rem;">
    <div>
      <h1 style="margin:0 0 .25rem 0; font-family:var(--font-serif); color:var(--charcoal);">Edit User</h1>
      <p class="muted" style="margin:0; max-width:520px;">Update username, password, role, or linked participant.</p>
    </div>
    <a class="btn-cream" href="/admin/users" style="padding:12px 18px; border-radius:12px; text-decoration:none; font-weight:600;">Back to Users</a>
  </header>

  <% if (error) { %>
    <div class="alert alert-danger" style="margin-bottom:1rem;"><%= error %></div>
  <% } %>

  <form method="POST" action="/admin/users/<%= user ? user.userid : '' %>/edit" class="card" style="padding:22px 22px 18px; border-radius:14px; border:1px solid #e7dfcf; background:#f7f3eb;">
    <div style="display:grid; gap:14px; grid-template-columns:repeat(auto-fit, minmax(260px, 1fr)); align-items:center;">
      <div class="form-group" style="grid-column:span 2;">
        <label for="username" style="font-weight:600;">Username (email)</label>
        <input type="text" id="username" name="username" class="form-control" required value="<%= (user && user.username) || '' %>" style="margin-top:6px;">
      </div>
      <div class="form-group" style="grid-column:span 2;">
        <label for="password" style="font-weight:600;">Password (leave blank to keep current)</label>
        <input type="password" id="password" name="password" class="form-control" style="margin-top:6px;">
      </div>
      <div class="form-group" style="display:flex; flex-direction:column; gap:8px;">
        <span style="font-weight:600;">Role / Level</span>
        <div style="display:flex; gap:14px; flex-wrap:wrap;">
          <label style="display:flex; gap:6px; align-items:center;">
            <input type="radio" name="level" value="m" <%= (user && user.level === 'm') ? 'checked' : '' %>> Manager
          </label>
          <label style="display:flex; gap:6px; align-items:center;">
            <input type="radio" name="level" value="u" <%= (!user || user.level === 'u') ? 'checked' : '' %>> User
          </label>
        </div>
      </div>
      <div class="form-group" style="display:flex; flex-direction:column; gap:6px;">
        <label for="participantid" style="font-weight:600;">Link to Participant (optional)</label>
        <input type="number" id="participantid" name="participantid" class="form-control" placeholder="Participant ID" value="<%= (user && user.participantid) || '' %>">
        <small class="muted">Leave blank to keep unlinked.</small>
      </div>
    </div>

    <div style="display:flex; gap:12px; flex-wrap:wrap; margin-top:18px;">
      <button type="submit" class="btn-gradient" style="padding:12px 16px; border-radius:12px; font-weight:700; min-width:160px;">Save Changes</button>
      <a href="/admin/users" class="btn-cream" style="padding:12px 16px; border-radius:12px; text-decoration:none; font-weight:600;">Cancel</a>
    </div>
  </form>
</main>
