<main class="container main-content" style="max-width:900px; margin-top:2.5rem;">
  <% function calcAge(d){ if(!d) return '—'; const dob=new Date(d); if(Number.isNaN(dob)) return '—'; const now=new Date(); let age=now.getFullYear()-dob.getFullYear(); const m=now.getMonth()-dob.getMonth(); if(m<0||(m===0&&now.getDate()<dob.getDate())) age--; return age; } %>

  <header style="display:flex; justify-content:space-between; align-items:center; gap:1rem; margin-bottom:1.25rem; flex-wrap:wrap;">
    <div>
      <h1 style="margin:0; font-family:var(--font-serif); color:var(--charcoal);">Participant Detail</h1>
      <p style="margin:.3rem 0 0 0; color:#4b5563;"><%= [participant.participantfirstname, participant.participantlastname].filter(Boolean).join(' ') %></p>
    </div>
    <div style="display:flex; gap:10px; flex-wrap:wrap;">
      <a href="/participants/<%= participant.participantid %>/edit" class="btn-cream" style="padding:10px 14px; border-radius:10px; text-decoration:none;">Edit</a>
      <a href="/participants" class="btn-cream" style="padding:10px 14px; border-radius:10px; text-decoration:none;">Back</a>
    </div>
  </header>

  <div class="card" style="padding:20px; border-radius:14px; border:1px solid #e5e7eb; background:#f9fafb; margin-bottom:1rem;">
    <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(240px,1fr)); gap:14px;">
      <div><strong>Name</strong><br><%= [participant.participantfirstname, participant.participantlastname].filter(Boolean).join(' ') || '—' %></div>
      <div><strong>Age</strong><br><%= calcAge(participant.participantdob) %></div>
      <div><strong>Email</strong><br><%= participant.participantemail || '—' %></div>
      <div><strong>Phone</strong><br><%= participant.participantphone || '—' %></div>
      <div><strong>City</strong><br><%= participant.participantcity || '—' %></div>
      <div><strong>State</strong><br><%= participant.participantstate || '—' %></div>
      <div><strong>Zip</strong><br><%= participant.participantzip || '—' %></div>
      <div><strong>Affiliation Type</strong><br><%= participant.participantaffiliationtype || '—' %></div>
      <div><strong>Affiliation Name</strong><br><%= participant.participantaffiliationname || '—' %></div>
      <div><strong>Field of Interest</strong><br><%= participant.participantfieldofinterest || '—' %></div>
      <div><strong>Total Donations</strong><br><%= participant.totaldonations || 0 %></div>
    </div>
  </div>

  <div class="card" style="padding:20px; border-radius:14px; border:1px solid #e5e7eb; background:#f9fafb; margin-bottom:1rem;">
    <h3 style="margin:0 0 .75rem 0;">User Account</h3>
    <% if (participant.username) { %>
      <div><strong>Username:</strong> <%= participant.username %></div>
      <div><strong>Password:</strong> <%= participant.password %></div>
    <% } else { %>
      <p style="color:#6b7280;">No linked user.</p>
    <% } %>
  </div>

  <div class="card" style="padding:20px; border-radius:14px; border:1px solid #e5e7eb; background:#f9fafb;">
    <h3 style="margin:0 0 .75rem 0;">Milestones</h3>
    <% if (!milestones || milestones.length === 0) { %>
      <p style="color:#6b7280;">No milestones assigned.</p>
    <% } else { %>
      <ul style="margin:0; padding-left:18px; color:#374151;">
        <% milestones.forEach(m => { %>
          <li><strong><%= m.milestonetitle %></strong> <% if (m.milestonedate) { %> — <%= m.milestonedate %> <% } %></li>
        <% }) %>
      </ul>
    <% } %>
  </div>
</main>
