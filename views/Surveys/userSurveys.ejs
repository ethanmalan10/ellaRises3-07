<section class="main-content" style="max-width: 900px; margin: 0 auto;">
  <div class="card" style="padding: 28px; border-radius: 18px;">
    <h2 style="margin:0 0 12px 0; font-family: var(--font-serif);">Share Your Event Survey</h2>
    <p style="margin:0 0 20px 0; color: var(--charcoal); opacity:0.8;">
      Submit feedback for an event you attended in the last month.
    </p>

    <% if (typeof error !== 'undefined' && error) { %>
      <div style="background:#ffe1e1; border:1px solid #dd9a9a; color:#7a2e2e; padding:12px 16px; border-radius:10px; margin-bottom:1.25rem;">
        <%= error %>
      </div>
    <% } %>

    <form method="POST" action="/surveys" style="display:grid; gap:14px;">
      <div>
        <label for="eventoccurrenceid" style="font-weight:600; display:block; margin-bottom:.35rem;">Event (past month)</label>
        <select
          id="eventoccurrenceid"
          name="eventoccurrenceid"
          required
          style="width:100%; padding:12px; border-radius:10px;"
        >
          <option value="">Select an event</option>
          <% const selectedEvent = formValues?.eventoccurrenceid ? Number(formValues.eventoccurrenceid) : null; %>
          <% (events || []).forEach(ev => { %>
            <option value="<%= ev.eventoccurrenceid %>" <%= selectedEvent === ev.eventoccurrenceid ? 'selected' : '' %>>
              <%= ev.eventname %> â€” <%= new Date(ev.eventdatetimestart).toLocaleDateString() %>
            </option>
          <% }) %>
        </select>
        <% if (!events || !events.length) { %>
          <p style="margin:6px 0 0 0; color:var(--charcoal); opacity:0.7; font-size:0.9rem;">
            No past events in the last month to review yet.
          </p>
        <% } %>
      </div>

      <div>
        <label for="satisfaction" style="font-weight:600; display:block; margin-bottom:.35rem;">Satisfaction (1-5)</label>
        <select id="satisfaction" name="satisfaction" required style="width:100%; padding:12px; border-radius:10px;">
          <% const satVal = Number(formValues?.satisfaction || 5); %>
          <% for (let i = 1; i <= 5; i++) { %>
            <option value="<%= i %>" <%= satVal === i ? 'selected' : '' %>><%= i %></option>
          <% } %>
        </select>
      </div>

      <div>
        <label for="usefulness" style="font-weight:600; display:block; margin-bottom:.35rem;">Usefulness (1-5)</label>
        <% const useVal = Number(formValues?.usefulness || 5); %>
        <select id="usefulness" name="usefulness" required style="width:100%; padding:12px; border-radius:10px;">
          <% for (let i = 1; i <= 5; i++) { %>
            <option value="<%= i %>" <%= useVal === i ? 'selected' : '' %>><%= i %></option>
          <% } %>
        </select>
      </div>

      <div>
        <label for="instructor" style="font-weight:600; display:block; margin-bottom:.35rem;">Instructor (1-5)</label>
        <% const instVal = Number(formValues?.instructor || 5); %>
        <select id="instructor" name="instructor" required style="width:100%; padding:12px; border-radius:10px;">
          <% for (let i = 1; i <= 5; i++) { %>
            <option value="<%= i %>" <%= instVal === i ? 'selected' : '' %>><%= i %></option>
          <% } %>
        </select>
      </div>

      <div>
        <label for="recommendation" style="font-weight:600; display:block; margin-bottom:.35rem;">Recommend (1-5)</label>
        <% const recVal = Number(formValues?.recommendation || 5); %>
        <select id="recommendation" name="recommendation" required style="width:100%; padding:12px; border-radius:10px;">
          <% for (let i = 1; i <= 5; i++) { %>
            <option value="<%= i %>" <%= recVal === i ? 'selected' : '' %>><%= i %></option>
          <% } %>
        </select>
      </div>

      <div>
        <label for="comments" style="font-weight:600; display:block; margin-bottom:.35rem;">Comments</label>
        <textarea
          id="comments"
          name="comments"
          rows="4"
          style="width:100%; padding:12px; border-radius:10px;"
        ><%= formValues?.comments || '' %></textarea>
      </div>

      <button type="submit" class="btn-login-home" style="padding:14px; border-radius:12px; font-size:1.05rem;">
        Submit Survey
      </button>
    </form>
  </div>

  <div class="card" style="padding: 24px; border-radius: 18px; margin-top:1.25rem;">
    <h3 style="margin:0 0 12px 0; font-family: var(--font-serif);">Recent Submissions</h3>
    <% if (surveys && surveys.length) { %>
      <div style="display:grid; gap:14px;">
        <% surveys.forEach(s => { %>
          <div style="border:1px solid #eee; border-radius:12px; padding:12px 16px;">
            <div style="display:flex; justify-content:space-between; align-items:center;">
              <div>
                <% const evLabel = s.eventName || s.eventname || (s.eventoccurrenceid ? `Event #${s.eventoccurrenceid}` : 'Unknown event'); %>
                <p style="margin:0; font-weight:700; color:var(--charcoal);">
                  <%= evLabel %>
                </p>
                <% const submittedAt = s.submittedAt || s.surveysubmissiondate; %>
                <% const submitted = submittedAt ? new Date(submittedAt) : null; %>
                <p style="margin:0; color:var(--charcoal); opacity:0.7;">
                  Submitted: <%= submitted && !Number.isNaN(submitted.valueOf()) ? submitted.toLocaleDateString() : 'N/A' %>
                </p>
              </div>
              <div>
                <% const avg = Number(((Number(s.satisfaction) + Number(s.usefulness) + Number(s.instructor) + Number(s.recommendation))/4).toFixed(1)); %>
                <p style="margin:0; font-weight:700; color:var(--charcoal);">Avg: <%= avg %>/5</p>
              </div>
            </div>
            <% if (s.comments) { %>
              <p style="margin:8px 0 0 0; color:var(--charcoal); opacity:0.8;"><%= s.comments %></p>
            <% } %>
          </div>
        <% }) %>
      </div>
    <% } else { %>
      <p style="margin:0; color:var(--charcoal); opacity:0.7;">No surveys submitted yet.</p>
    <% } %>
  </div>
</section>
