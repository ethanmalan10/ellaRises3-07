<%
  // Access the logged-in user (provided by index.js via res.locals.currentUser)
  const user = typeof currentUser !== 'undefined' ? currentUser : null;
  const isManager = user && (
    user.role === 'manager' ||
    user.role === 'admin' ||
    user.level === 'm' ||
    user.level === 'a' ||
    user.level === 'manager' ||
    user.level === 'admin'
  );
%>
<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Head partial (CSS, fonts, <meta>, etc.) -->
  <%- include('_head') %>
</head>

<body>

  <!-- NAVBAR -->
  <nav class="navbar">

    <!-- Logo -->
    <a href="/" class="navbar-brand">
      <img src="/images/EllaRisesLogo.avif" alt="Ella Rises" class="logo-img">
    </a>

    <!-- Center Section: Main Links -->
    <div class="navbar-nav" style="margin-left: .25rem;">
      <a href="/donations" class="nav-link">Donations</a>
      <% if (user) { %>
        <a href="/surveys"   class="nav-link">Surveys</a>
      <% } %>
      <a href="/events"    class="nav-link">Events</a>
    </div>

    <!-- Right Side -->
    <div class="navbar-nav" style="margin-left:auto;">
      <button
        id="lang-toggle"
        type="button"
        class="nav-link lang-toggle-btn notranslate"
        aria-label="Cambiar a español"
        aria-pressed="false">
        Cambiar a español
      </button>

      <% if (!user) { %>
        <!-- Login / Register Dropdown -->
        <div class="dropdown">
          <a href="#" class="nav-link">Login / Register</a>
          <div class="dropdown-content">
            <a href="/login">Login</a>
            <a href="/register">Create Account</a>
          </div>
        </div>

      <% } else { %>
        <!-- User Dropdown -->
        <div class="dropdown">
          <a href="#" class="nav-link">My Account</a>
          <div class="dropdown-content">

            <!-- Always available -->
            <a href="/my-account">My Account</a>

            <!-- Manager/Admin Only -->
            <% if (isManager) { %>
              <a href="/participants">All Participants</a>
              <a href="/admin/users">All Users</a>
              <a href="/admin/milestones">Manage Milestones</a>
              <a href="/dashboard">Dashboard</a>
              <a href="/admin/surveys">View Surveys</a>
              <a href="/admin/donations">View Donations</a>
            <% } else { %>
              <!-- Regular users see milestones -->
              <a href="/milestones">Milestones</a>
            <% } %>

            <!-- Logout -->
            <a href="/logout">Logout</a>

          </div>
        </div>
      <% } %>

    </div>
  </nav>

  <main class="container">
    <%- body %>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <p>&copy; 2025 Ella Rises. Empowering the rising generation of women.</p>
  </footer>

  <div id="google_translate_element" aria-hidden="true" style="display:none;"></div>
  <script src="/js/lang-toggle.js"></script>
</body>
</html>
