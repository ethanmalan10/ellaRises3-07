<main class="container main-content" style="max-width:760px; margin-top:2.5rem;">
  <div class="card" style="padding:32px; border-radius:14px;">
    <h2 style="margin:0 0 1rem 0; font-family:var(--font-serif); color:var(--charcoal);">Edit Account</h2>
    <p style="margin:0 0 1rem 0; color:#4b5563;">Update your profile details.</p>

    <% if (error) { %>
      <div style="background:#ffe1e1; border:1px solid #dd9a9a; color:#7a2e2e; padding:12px 16px; border-radius:10px; margin-bottom:1rem;">
        <%= error %>
      </div>
    <% } %>

    <% if (!participant) { %>
      <p style="color:#4b5563;">No participant profile found for this account.</p>
    <% } else { %>
      <form method="POST" action="/my-account/edit" novalidate>
        <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(220px,1fr)); gap:12px; margin-bottom:1rem;">
          <div>
            <label style="font-weight:600; display:block; margin-bottom:.35rem;">First Name</label>
            <input name="participantfirstname" type="text" value="<%= participant.participantfirstname || '' %>" style="width:100%; padding:12px; border-radius:10px;" onblur="this.value = formatCap(this.value)">
          </div>
          <div>
            <label style="font-weight:600; display:block; margin-bottom:.35rem;">Last Name</label>
            <input name="participantlastname" type="text" value="<%= participant.participantlastname || '' %>" style="width:100%; padding:12px; border-radius:10px;" onblur="this.value = formatCap(this.value)">
          </div>
        </div>

        <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(220px,1fr)); gap:12px; margin-bottom:1rem;">
          <div>
            <label style="font-weight:600; display:block; margin-bottom:.35rem;">Phone</label>
            <input name="participantphone" type="text" value="<%= participant.participantphone || '' %>" style="width:100%; padding:12px; border-radius:10px;" inputmode="tel" pattern="\\d*" onkeypress="return allowDigits(event)" oninput="digitsOnly(this)" onblur="digitsOnly(this)">
          </div>
          <div>
            <label style="font-weight:600; display:block; margin-bottom:.35rem;">Date of Birth</label>
            <input name="participantdob" type="date" value="<%= participant.participantdob ? participant.participantdob.toISOString().slice(0,10) : '' %>" style="width:100%; padding:12px; border-radius:10px;">
          </div>
        </div>

        <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(220px,1fr)); gap:12px; margin-bottom:1rem;">
          <div>
            <label style="font-weight:600; display:block; margin-bottom:.35rem;">City</label>
            <input name="participantcity" type="text" value="<%= participant.participantcity || '' %>" style="width:100%; padding:12px; border-radius:10px;" onblur="this.value = formatCap(this.value)">
          </div>
          <div>
            <label style="font-weight:600; display:block; margin-bottom:.35rem;">State</label>
            <select name="participantstate" style="width:100%; padding:12px; border-radius:10px;">
              <option value="">Select</option>
              <% const states = ['AL','AK','AZ','AR','CA','CO','CT','DE','FL','GA','HI','ID','IL','IN','IA','KS','KY','LA','ME','MD','MA','MI','MN','MS','MO','MT','NE','NV','NH','NJ','NM','NY','NC','ND','OH','OK','OR','PA','RI','SC','SD','TN','TX','UT','VT','VA','WA','WV','WI','WY','Other']; %>
              <% states.forEach(st => { %>
                <option value="<%= st %>" <%= st === participant.participantstate ? 'selected' : '' %>><%= st %></option>
              <% }) %>
            </select>
          </div>
          <div>
            <label style="font-weight:600; display:block; margin-bottom:.35rem;">Zip</label>
            <input name="participantzip" type="text" value="<%= participant.participantzip || '' %>" inputmode="numeric" pattern="\\d*" style="width:100%; padding:12px; border-radius:10px;" oninput="digitsOnly(this)">
          </div>
        </div>

        <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(220px,1fr)); gap:12px; margin-bottom:1rem;">
          <div>
            <label style="font-weight:600; display:block; margin-bottom:.35rem;">Affiliation Type</label>
            <input name="participantaffiliationtype" type="text" value="<%= participant.participantaffiliationtype || '' %>" style="width:100%; padding:12px; border-radius:10px;">
          </div>
          <div>
            <label style="font-weight:600; display:block; margin-bottom:.35rem;">Affiliation Name</label>
            <input name="participantaffiliationname" type="text" value="<%= participant.participantaffiliationname || '' %>" style="width:100%; padding:12px; border-radius:10px;">
          </div>
        </div>

        <div style="margin-bottom:1rem;">
          <label style="font-weight:600; display:block; margin-bottom:.35rem;">Field of Interest</label>
          <input name="participantfieldofinterest" type="text" value="<%= participant.participantfieldofinterest || '' %>" style="width:100%; padding:12px; border-radius:10px;">
        </div>

        <div style="display:flex; gap:12px; align-items:center; margin-top:1.2rem;">
          <button type="submit" class="btn-gradient" style="padding:12px 18px; border-radius:12px;">Save Changes</button>
          <a href="/my-account" class="btn-cream" style="padding:10px 16px; border-radius:10px; text-decoration:none;">Cancel</a>
        </div>
      </form>
    <% } %>
  </div>
</main>

<script>
  function formatCap(val) {
    if (!val) return '';
    const s = val.trim();
    if (!s) return '';
    return s[0].toUpperCase() + s.slice(1).toLowerCase();
  }
  function digitsOnly(el) {
    if (!el) return;
    el.value = (el.value || '').replace(/\\D/g, '');
  }
  function allowDigits(e) {
    const k = e.key;
    if (k === 'Backspace' || k === 'Delete' || k === 'Tab' || k === 'ArrowLeft' || k === 'ArrowRight') return true;
    if (/\\d/.test(k)) return true;
    e.preventDefault();
    return false;
  }
</script>
